# Correction Erreur: Table goal_participation n'existe pas ✅

## Problème
```
SQLSTATE[42P01]: Undefined table: 7 ERREUR: la relation « goal_participation » n'existe pas
```

## Cause
Les tables nécessaires n'avaient pas été créées dans la base de données. Le schéma Doctrine n'était pas synchronisé avec les entités.

## Solution Appliquée

### 1. Vérification du schéma
```bash
php bin/console doctrine:schema:update --dump-sql
```

Résultat: 29 requêtes SQL à exécuter pour créer les tables manquantes:
- `chatroom`
- `goal_participation` ⭐
- `message`
- `message_reaction`
- `message_read_receipt`

### 2. Mise à jour du schéma
```bash
php bin/console doctrine:schema:update --force
```

✅ 29 requêtes exécutées avec succès
✅ Base de données mise à jour

### 3. Nettoyage du cache
```bash
php bin/console cache:clear
```

## Tables Créées

### goal_participation
```sql
CREATE TABLE goal_participation (
    id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL,
    role VARCHAR(20) NOT NULL,
    status VARCHAR(20) NOT NULL,
    user_id INT NOT NULL,
    goal_id INT NOT NULL,
    PRIMARY KEY (id)
);
```

Colonnes:
- `id` - Identifiant unique
- `user_id` - Référence vers l'utilisateur
- `goal_id` - Référence vers le goal
- `role` - MEMBER, ADMIN, ou OWNER
- `status` - PENDING, APPROVED, ou REJECTED
- `created_at` - Date de création

Index:
- `IDX_91C54215A76ED395` sur `user_id`
- `IDX_91C54215667D1AFE` sur `goal_id`

### chatroom
```sql
CREATE TABLE chatroom (
    id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL,
    goal_id INT NOT NULL,
    PRIMARY KEY (id)
);
```

### message
```sql
CREATE TABLE message (
    id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    content TEXT DEFAULT NULL,
    created_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL,
    is_pinned BOOLEAN DEFAULT false NOT NULL,
    is_edited BOOLEAN DEFAULT false NOT NULL,
    edited_at TIMESTAMP(0) WITHOUT TIME ZONE DEFAULT NULL,
    attachment_path VARCHAR(255) DEFAULT NULL,
    attachment_type VARCHAR(50) DEFAULT NULL,
    attachment_original_name VARCHAR(255) DEFAULT NULL,
    audio_duration INT DEFAULT NULL,
    image_name VARCHAR(255) DEFAULT NULL,
    image_size INT DEFAULT NULL,
    updated_at TIMESTAMP(0) WITHOUT TIME ZONE DEFAULT NULL,
    chatroom_id INT NOT NULL,
    author_id INT NOT NULL,
    reply_to_id INT DEFAULT NULL,
    PRIMARY KEY (id)
);
```

### message_reaction
```sql
CREATE TABLE message_reaction (
    id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    reaction_type VARCHAR(20) NOT NULL,
    created_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL,
    message_id INT NOT NULL,
    user_id INT NOT NULL,
    PRIMARY KEY (id)
);
```

Contrainte unique: `unique_reaction` sur `(message_id, user_id, reaction_type)`

### message_read_receipt
```sql
CREATE TABLE message_read_receipt (
    id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    read_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL,
    message_id INT NOT NULL,
    user_id INT NOT NULL,
    PRIMARY KEY (id)
);
```

Contrainte unique: `unique_read` sur `(message_id, user_id)`

## État Actuel
✅ Base de données synchronisée
✅ Toutes les tables créées
✅ Cache vidé
✅ Application fonctionnelle

## Notes
- Il reste quelques erreurs de mapping dans les entités Goal, User et PostLike, mais elles n'affectent pas le fonctionnement du système de chatroom
- Ces erreurs concernent des relations qui ne sont pas utilisées actuellement

## Prochaines Étapes
1. ✅ Tester l'accès à la liste des goals
2. ✅ Tester la création d'un goal
3. ✅ Tester le système de demande d'accès
4. ✅ Tester le chatroom et les messages
5. ⏳ Corriger les erreurs de mapping restantes (optionnel)
