<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chatroom - Emojis et Images</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f2f5;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            margin-bottom: 20px;
            color: #333;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .test-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #0084ff;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .input-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            color: #65676b;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 20px;
        }

        .input-btn:hover {
            background: rgba(0, 132, 255, 0.1);
            color: #0084ff;
            transform: scale(1.1);
        }

        .input-btn.active {
            background: rgba(0, 132, 255, 0.15);
            color: #0084ff;
        }

        textarea {
            flex: 1;
            border: none;
            background: transparent;
            padding: 10px;
            font-size: 15px;
            outline: none;
            resize: none;
            font-family: inherit;
        }

        .emoji-picker {
            position: relative;
            margin-top: 10px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            display: none;
        }

        .emoji-picker.active {
            display: block;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
        }

        .emoji-item {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .emoji-item:hover {
            background: #f0f2f5;
            transform: scale(1.2);
        }

        .file-preview {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .file-preview.active {
            display: flex;
        }

        .file-preview-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #0084ff;
        }

        .file-preview-icon img {
            width: 48px;
            height: 48px;
            object-fit: cover;
            border-radius: 8px;
        }

        .file-preview-info {
            flex: 1;
        }

        .file-preview-name {
            font-weight: 600;
            color: #333;
        }

        .file-preview-size {
            font-size: 12px;
            color: #666;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            background: #e7f3ff;
            border-radius: 8px;
            color: #0084ff;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test Chatroom - Emojis et Images</h1>

        <!-- Test 1: Emojis -->
        <div class="test-section">
            <h2>Test 1: S√©lecteur d'Emojis</h2>
            <div class="input-wrapper">
                <button type="button" class="input-btn" id="emojiBtn" onclick="toggleEmojiPicker()">
                    <i class="fas fa-smile"></i>
                </button>
                <textarea id="messageInput" placeholder="Cliquez sur üòä puis sur un emoji..." rows="1"></textarea>
            </div>
            <div class="emoji-picker" id="emojiPicker">
                <div class="emoji-grid">
                    <button class="emoji-item" onclick="insertEmoji('üòÄ')">üòÄ</button>
                    <button class="emoji-item" onclick="insertEmoji('üòÉ')">üòÉ</button>
                    <button class="emoji-item" onclick="insertEmoji('üòÑ')">üòÑ</button>
                    <button class="emoji-item" onclick="insertEmoji('üòÅ')">üòÅ</button>
                    <button class="emoji-item" onclick="insertEmoji('üòÖ')">üòÖ</button>
                    <button class="emoji-item" onclick="insertEmoji('üòÇ')">üòÇ</button>
                    <button class="emoji-item" onclick="insertEmoji('ü§£')">ü§£</button>
                    <button class="emoji-item" onclick="insertEmoji('üòä')">üòä</button>
                    <button class="emoji-item" onclick="insertEmoji('üëç')">üëç</button>
                    <button class="emoji-item" onclick="insertEmoji('üëè')">üëè</button>
                    <button class="emoji-item" onclick="insertEmoji('üî•')">üî•</button>
                    <button class="emoji-item" onclick="insertEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</button>
                    <button class="emoji-item" onclick="insertEmoji('üíØ')">üíØ</button>
                    <button class="emoji-item" onclick="insertEmoji('üéâ')">üéâ</button>
                    <button class="emoji-item" onclick="insertEmoji('‚ú®')">‚ú®</button>
                    <button class="emoji-item" onclick="insertEmoji('üöÄ')">üöÄ</button>
                </div>
            </div>
            <div class="status" id="emojiStatus">Statut: En attente...</div>
        </div>

        <!-- Test 2: Upload d'Image -->
        <div class="test-section">
            <h2>Test 2: Upload d'Image</h2>
            <div class="input-wrapper">
                <label for="fileInput" class="input-btn" id="fileBtn">
                    <i class="fas fa-paperclip"></i>
                </label>
                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(this)">
                <span style="flex: 1; padding: 10px;">Cliquez sur üìé pour s√©lectionner une image</span>
            </div>
            <div class="file-preview" id="filePreview">
                <div class="file-preview-icon" id="filePreviewIcon"></div>
                <div class="file-preview-info">
                    <div class="file-preview-name" id="filePreviewName"></div>
                    <div class="file-preview-size" id="filePreviewSize"></div>
                </div>
            </div>
            <div class="status" id="fileStatus">Statut: En attente...</div>
        </div>

        <!-- Test 3: Diagnostic -->
        <div class="test-section">
            <h2>Test 3: Diagnostic Automatique</h2>
            <button onclick="runDiagnostic()" style="padding: 10px 20px; background: #0084ff; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Lancer le Diagnostic
            </button>
            <div class="status" id="diagnosticStatus" style="margin-top: 10px;">Cliquez sur le bouton pour lancer le diagnostic</div>
        </div>
    </div>

    <script>
        // Fonction 1: Toggle Emoji Picker
        function toggleEmojiPicker() {
            const picker = document.getElementById('emojiPicker');
            const btn = document.getElementById('emojiBtn');
            const status = document.getElementById('emojiStatus');
            
            if (picker.classList.contains('active')) {
                picker.classList.remove('active');
                btn.classList.remove('active');
                status.textContent = 'Statut: S√©lecteur ferm√©';
                status.className = 'status';
            } else {
                picker.classList.add('active');
                btn.classList.add('active');
                status.textContent = 'Statut: S√©lecteur ouvert ‚úÖ';
                status.className = 'status success';
            }
        }

        // Fonction 2: Insert Emoji
        function insertEmoji(emoji) {
            const input = document.getElementById('messageInput');
            const status = document.getElementById('emojiStatus');
            
            if (!input) {
                status.textContent = 'Erreur: Input non trouv√© ‚ùå';
                status.className = 'status error';
                return;
            }
            
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(cursorPos);
            
            input.value = textBefore + emoji + textAfter;
            
            const newCursorPos = cursorPos + emoji.length;
            input.setSelectionRange(newCursorPos, newCursorPos);
            input.focus();
            
            status.textContent = `Statut: Emoji ${emoji} ins√©r√© ‚úÖ`;
            status.className = 'status success';
        }

        // Fonction 3: Handle File Select
        function handleFileSelect(input) {
            const file = input.files[0];
            const preview = document.getElementById('filePreview');
            const icon = document.getElementById('filePreviewIcon');
            const name = document.getElementById('filePreviewName');
            const size = document.getElementById('filePreviewSize');
            const status = document.getElementById('fileStatus');
            const btn = document.getElementById('fileBtn');
            
            if (!file) {
                status.textContent = 'Statut: Aucun fichier s√©lectionn√©';
                status.className = 'status';
                return;
            }
            
            // Afficher pr√©visualisation
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    icon.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            } else {
                icon.innerHTML = '<i class="fas fa-file"></i>';
            }
            
            name.textContent = file.name;
            size.textContent = formatFileSize(file.size);
            preview.classList.add('active');
            btn.classList.add('active');
            
            status.textContent = `Statut: Fichier "${file.name}" s√©lectionn√© ‚úÖ`;
            status.className = 'status success';
        }

        // Fonction 4: Format File Size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Fonction 5: Diagnostic
        function runDiagnostic() {
            const status = document.getElementById('diagnosticStatus');
            let report = '<strong>Rapport de Diagnostic:</strong><br><br>';
            
            // Test des √©l√©ments
            const elements = {
                'messageInput': document.getElementById('messageInput'),
                'emojiPicker': document.getElementById('emojiPicker'),
                'emojiBtn': document.getElementById('emojiBtn'),
                'fileInput': document.getElementById('fileInput'),
                'filePreview': document.getElementById('filePreview')
            };
            
            report += '<strong>√âl√©ments HTML:</strong><br>';
            for (const [name, element] of Object.entries(elements)) {
                report += `${name}: ${element ? '‚úÖ' : '‚ùå'}<br>`;
            }
            
            // Test des fonctions
            report += '<br><strong>Fonctions JavaScript:</strong><br>';
            const functions = {
                'toggleEmojiPicker': typeof toggleEmojiPicker,
                'insertEmoji': typeof insertEmoji,
                'handleFileSelect': typeof handleFileSelect,
                'formatFileSize': typeof formatFileSize
            };
            
            for (const [name, type] of Object.entries(functions)) {
                report += `${name}: ${type === 'function' ? '‚úÖ' : '‚ùå'}<br>`;
            }
            
            // Conclusion
            const allElementsOk = Object.values(elements).every(el => el !== null);
            const allFunctionsOk = Object.values(functions).every(fn => fn === 'function');
            
            if (allElementsOk && allFunctionsOk) {
                report += '<br><strong style="color: green;">‚úÖ Tous les tests pass√©s! Syst√®me op√©rationnel.</strong>';
                status.className = 'status success';
            } else {
                report += '<br><strong style="color: red;">‚ùå Certains tests ont √©chou√©. V√©rifier les √©l√©ments manquants.</strong>';
                status.className = 'status error';
            }
            
            status.innerHTML = report;
        }

        // Auto-diagnostic au chargement
        window.addEventListener('load', function() {
            console.log('=== TEST CHATROOM CHARG√â ===');
            console.log('Tous les √©l√©ments et fonctions sont disponibles.');
            console.log('Utilisez les boutons pour tester les fonctionnalit√©s.');
        });
    </script>
</body>
</html>
